import{d as O,b as P,R as m,j as e,e as I,f as A,u as W,h as U,i as q,c as y,r as ee,k as te,l as ae}from"./index-63539b76.js";import{d as H,A as E,e as se,a as L,f as ne,L as re}from"./tour-ec962f5c.js";import{G as C,c as w,_ as V,e as N,s as _}from"./PulseLoader-4a10919f.js";import{u as ie,M as oe,A as le,b as $,c as ce}from"./index.esm-c2a0ced5.js";import{a as de}from"./index.esm-ea0229c7.js";import{u as ue,b as me,a as pe}from"./room-95e60218.js";import{P as F}from"./PannellumVideo-843df1f4.js";O({key:"scene",default:[]});O({key:"scene-menu",default:null});const Y=O({key:"viewer-coordinate",default:{pitch:0,yaw:0}}),Q=O({key:"initial-viewer-coordinate",default:{pitch:0,yaw:0}});function xe(t){return C({tag:"svg",attr:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"}}]})(t)}function ge(t){return C({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 464c114.9 0 208-93.1 208-208S370.9 48 256 48 48 141.1 48 256s93.1 208 208 208zm0-244.5l-81.1 81.9c-7.5 7.5-19.8 7.5-27.3 0s-7.5-19.8 0-27.3l95.7-95.4c7.3-7.3 19.1-7.5 26.6-.6l94.3 94c3.8 3.8 5.7 8.7 5.7 13.7 0 4.9-1.9 9.9-5.6 13.6-7.5 7.5-19.7 7.6-27.3 0l-81-79.9z"}}]})(t)}function he(t){return C({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M416 277.333H277.333V416h-42.666V277.333H96v-42.666h138.667V96h42.666v138.667H416v42.666z"}}]})(t)}function fe(t){return C({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M288 144a110.94 110.94 0 0 0-31.24 5 55.4 55.4 0 0 1 7.24 27 56 56 0 0 1-56 56 55.4 55.4 0 0 1-27-7.24A111.71 111.71 0 1 0 288 144zm284.52 97.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400c-98.65 0-189.09-55-237.93-144C98.91 167 189.34 112 288 112s189.09 55 237.93 144C477.1 345 386.66 400 288 400z"}}]})(t)}function be(t){return C({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M231.4,44.34s0,.1,0,.15l-58.2,191.94a15.88,15.88,0,0,1-14,11.51q-.69.06-1.38.06a15.86,15.86,0,0,1-14.42-9.15l-35.71-75.39a4,4,0,0,1,.79-4.54l57.26-57.27a8,8,0,0,0-11.31-11.31L97.08,147.6a4,4,0,0,1-4.54.79l-75-35.53A16.37,16.37,0,0,1,8,97.36,15.89,15.89,0,0,1,19.57,82.84l191.94-58.2.15,0A16,16,0,0,1,231.4,44.34Z"}}]})(t)}const ve="",ye=({isShow:t,onClose:n})=>{var l;const{idTour:r}=P(),{data:a}=ie(),{mutate:s,status:c}=ue(),[f,x]=m.useState("Ruangan"),[h,d]=m.useState(null),g=i=>()=>d(i),p=()=>{n(),d(null)},v=()=>{if(!h){N({message:"Silahkan pilih gambar dahulu"});return}s({image_url:h,name:f,tour_id:Number(r)},{onSuccess:()=>{_({message:"Behasil membuat ruangan baru"}),x("Ruangan"),d(null),p()},onError:()=>{N({message:"Gagal membuat ruangan"})}})};return e.jsx(oe,{show:t,children:e.jsxs("div",{className:"bg-white rounded-sm px-4 w-5/12",children:[e.jsx("header",{className:"flex justify-end pt-3","aria-label":"modal-head",children:e.jsx("button",{disabled:c==="loading",type:"button",onClick:p,children:e.jsx(le,{className:"text-lg"})})}),e.jsxs("div",{className:"py-4","aria-label":"modal-body",children:[e.jsx("div",{className:"max-h-[330px] overflow-auto","aria-label":"images-container",children:e.jsx("div",{className:"grid grid-cols-2 gap-3 pr-2","aria-label":"images-wrapper",children:(l=a==null?void 0:a.data)==null?void 0:l.map((i,u)=>e.jsxs("div",{className:w("col-span-1 cursor-pointer relative"),onClick:g(i.file_path),children:[e.jsx("img",{src:ve+(i==null?void 0:i.thumbnail_path),alt:"avatar",loading:"lazy"}),h===i.file_path&&e.jsx("div",{className:"absolute inset-0 bg-black/60 z-10 flex justify-center items-center","aria-label":"selected-overlay",children:e.jsx("div",{className:"bg-white flex flex-col justify-center items-center rounded-full p-1",children:e.jsx(de,{className:"text-4xl text-blue-600"})})})]},u))})}),e.jsxs("div",{className:"mt-3 px-3","aria-label":"submit-container",children:[e.jsxs("div",{className:"text-white",children:[e.jsx("label",{htmlFor:"tour-name",className:"text-sm",children:"Tour name"}),e.jsx("input",{id:"tour-name",type:"text",className:w("border-gray-300 focus:border-gray-300 focus:ring-0 px-4 text-gray-900","focus:outline-none w-full tracking-wide rounded-md","placeholder:font-medium placeholder:tracking-wide placeholder:text-gray-400","peer/search"),value:f,onChange:i=>x(i.target.value)})]}),e.jsx("button",{disabled:c==="loading",type:"button",onClick:v,className:"bg-blue-500 relative text-white w-full px-3 py-2 rounded-md font-medium mt-4",children:c==="loading"?e.jsx(V,{color:"white",size:10}):"Simpan"})]})]})]})})},je=()=>{const t=I();return H({mutationFn:async r=>{const a=new FormData;return a.append("tour_id",String(r.tour_id)),a.append("room_id",String(r.room_id)),a.append("pitch",String(r.pitch)),a.append("yaw",String(r.yaw)),a.append("type",String(r.type)),a.append("text",String(r.text??"")),(await E.post("/api/hotspot",a)).data},onSuccess:()=>t.invalidateQueries(["HOTSPOTS"])})},X=()=>{const t=I();return H({mutationFn:async r=>(await E.post(`/api/hotspot/${r.hostpot_id}`,r.payload,{headers:{"content-type":"application/x-www-form-urlencoded"}})).data,onSuccess:()=>t.invalidateQueries(["HOTSPOTS"])})},Z=()=>{const t=I();return H({mutationFn:async({hostpot_id:r})=>(await E.delete(`/api/hotspot/${r}`)).data,onSuccess:()=>t.invalidateQueries(["HOTSPOTS"])})},B={addRuangan:!1},we=()=>{const[t]=A(),{idTour:n}=P(),r=W(),a=t.get("roomId"),{data:s}=se({tour_id:Number(n)}),{data:c}=L({id:Number(n)}),{mutate:f,status:x}=ne(),{mutate:h}=je(),d=m.useMemo(()=>c==null?void 0:c.data,[c==null?void 0:c.data]),[g,p]=m.useState(""),[v,l]=m.useState(B),i=U(Q),u=q(Y);m.useEffect(()=>{p(s==null?void 0:s.data.name)},[s==null?void 0:s.data.name]);const S=b=>()=>r(`/editor/${n}?roomId=${b}`),M=m.useCallback(b=>()=>{switch(b){case"addRuangan":l({addRuangan:!0});break}},[]),R=b=>()=>{h({pitch:u.pitch,yaw:u.yaw,type:b,tour_id:Number(n),room_id:Number(a)},{onSuccess:()=>{_({message:"Berhasil menambah hotspot"})},onError:()=>{N({message:"Gagal menambah hotspot"})}}),i({pitch:u.pitch,yaw:u.yaw})},o=()=>{f({tour_id:Number(n),name:g},{onSuccess:()=>{_({message:"Success update tour"})},onError:()=>{N({message:"Failed update tour"})}})},j=m.useCallback(()=>l(B),[]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:w("col-span-2 bg-gray-800 pt-2 pb-5","min-h-[calc(100vh_-_60px)] flex flex-col justify-between"),children:[e.jsxs("div",{children:[e.jsxs("section",{className:"text-white py-1","aria-label":"tools",children:[e.jsx("h3",{className:"text-[.85rem] font-semibold px-5 text-gray-300",children:"TOOLS"}),e.jsxs("div",{className:"mt-2 flex flex-col gap-[3px]","aria-label":"btn-action-contianer",children:[e.jsxs("button",{className:w("flex items-center gap-3 px-5 w-full py-[10px] bg-gray-700 hover:bg-gray-600 transition"),type:"button",onClick:R("info"),children:[e.jsx(xe,{className:"text-2xl"}),e.jsx("p",{children:"Tambah Text"})]}),e.jsxs("button",{className:w("flex items-center gap-3 px-5 w-full py-[10px] bg-gray-700 hover:bg-gray-600 transition"),type:"button",onClick:R("custom"),children:[e.jsx(ge,{className:"text-2xl"}),e.jsx("p",{children:"Tambah Hotspot"})]}),e.jsxs("button",{className:"flex items-center gap-3 px-5 w-full py-[10px] bg-gray-700",type:"button",children:[e.jsx(fe,{className:"text-2xl"}),e.jsx("p",{children:"Tetapkan view awal"})]})]})]}),e.jsxs("section",{className:"mt-2","aria-label":"ruangan",children:[e.jsxs("header",{className:"flex items-center justify-between pr-4",children:[e.jsx("h3",{className:"text-[.85rem] font-semibold px-5 text-gray-300",children:"RUANGAN"}),e.jsx("button",{className:"border border-white rounded-md p-[.4rem]",onClick:M("addRuangan"),children:e.jsx(he,{className:"text-white"})})]}),e.jsx("div",{className:"max-h-[300px] overflow-auto mt-2","aria-label":"list-ruangan-container",children:e.jsx("div",{className:"text-white flex flex-col gap-[3px]","aria-label":"list-ruangan-wrapper",children:d==null?void 0:d.map((b,k)=>e.jsxs("button",{className:w("flex items-center gap-3 px-5 w-full py-3",Number(a)===b.id?"bg-gray-600":"bg-gray-700"),type:"button",onClick:S(b.id),children:[e.jsx(be,{className:"text-xl"}),e.jsx("p",{className:"text-[.9rem]",children:b.name})]},k))})})]})]}),e.jsxs("div",{className:"mt-3 px-3","aria-label":"submit",children:[e.jsxs("div",{className:"text-white",children:[e.jsx("label",{htmlFor:"tour-name",className:"text-sm",children:"Tour name"}),e.jsx("input",{id:"tour-name",type:"text",className:w("border-gray-300 focus:border-gray-300 focus:ring-0 px-4 text-gray-900","focus:outline-none w-full tracking-wide rounded-md","placeholder:font-medium placeholder:tracking-wide placeholder:text-gray-400","peer/search"),value:g,onChange:b=>p(b.target.value)})]}),e.jsx("button",{onClick:o,disabled:x==="loading",className:"bg-blue-500 relative text-white w-full px-3 py-2 rounded-md font-medium mt-4",children:x==="loading"?e.jsx(V,{color:"white",size:10}):"Simpan"})]})]}),e.jsx(ye,{isShow:v.addRuangan,onClose:j})]})};var J={},T=y&&y.__assign||function(){return T=Object.assign||function(t){for(var n,r=1,a=arguments.length;r<a;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},T.apply(this,arguments)},Ne=y&&y.__createBinding||(Object.create?function(t,n,r,a){a===void 0&&(a=r);var s=Object.getOwnPropertyDescriptor(n,r);(!s||("get"in s?!n.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return n[r]}}),Object.defineProperty(t,a,s)}:function(t,n,r,a){a===void 0&&(a=r),t[a]=n[r]}),_e=y&&y.__setModuleDefault||(Object.create?function(t,n){Object.defineProperty(t,"default",{enumerable:!0,value:n})}:function(t,n){t.default=n}),Se=y&&y.__importStar||function(t){if(t&&t.__esModule)return t;var n={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&Ne(n,t,r);return _e(n,t),n},Ce=y&&y.__rest||function(t,n){var r={};for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&n.indexOf(a)<0&&(r[a]=t[a]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,a=Object.getOwnPropertySymbols(t);s<a.length;s++)n.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(t,a[s])&&(r[a[s]]=t[a[s]]);return r};Object.defineProperty(J,"__esModule",{value:!0});var Re=Se(ee),G=ae,ke=te,Te=(0,ke.createAnimation)("ClipLoader","0% {transform: rotate(0deg) scale(1)} 50% {transform: rotate(180deg) scale(0.8)} 100% {transform: rotate(360deg) scale(1)}","clip");function Oe(t){var n=t.loading,r=n===void 0?!0:n,a=t.color,s=a===void 0?"#000000":a,c=t.speedMultiplier,f=c===void 0?1:c,x=t.cssOverride,h=x===void 0?{}:x,d=t.size,g=d===void 0?35:d,p=Ce(t,["loading","color","speedMultiplier","cssOverride","size"]),v=T({background:"transparent !important",width:(0,G.cssValue)(g),height:(0,G.cssValue)(g),borderRadius:"100%",border:"2px solid",borderTopColor:s,borderBottomColor:"transparent",borderLeftColor:s,borderRightColor:s,display:"inline-block",animation:"".concat(Te," ").concat(.75/f,"s 0s infinite linear"),animationFillMode:"both"},h);return r?Re.createElement("span",T({style:v},p)):null}var K=J.default=Oe;const Me=({hotspot:t,coordinateX:n,coordinateY:r,forceRenderPanorana:a,onClose:s})=>{const c=m.useRef(null),{mutate:f,status:x}=X(),{mutate:h,status:d}=Z(),[g,p]=m.useState((t==null?void 0:t.text)??"");m.useEffect(()=>{p(t.text)},[t.text]);const v=()=>{const i=new FormData;i.append("text",g),i.append("_method","PUT"),f({hostpot_id:Number(t.id),payload:i},{onSuccess:()=>{_({message:"Berhasil update hotspot"}),s()},onError:()=>{N({message:"Gagal update hotspot"}),s()}})},l=()=>{confirm("Yakin ingin menghapus hotspot ini ?")&&h({hostpot_id:t.id},{onSuccess:()=>{s(),_({message:"Berhasil menghapus hotspot"}),a()},onError:()=>{N({message:"Gagal menghapus hotspot"})}})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:c,onClick:i=>i.stopPropagation(),style:{position:"fixed",zIndex:"1000",left:n+30,top:r+10},className:"bg-white/90 rounded-md p-3",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{htmlFor:"information-text",className:"font-medium",children:"Information text"}),e.jsx("input",{id:"information-text",type:"text",className:"rounded-md",value:g,onChange:i=>p(i.target.value)})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[e.jsx("div",{children:(x==="loading"||d==="loading")&&e.jsx(K,{size:16})}),e.jsxs("div",{className:"flex justify-center items-center gap-x-3",children:[e.jsx("button",{disabled:x==="loading",type:"button",onClick:v,children:"Save"}),e.jsx("button",{disabled:d==="loading",onClick:l,type:"button",className:"w-max",children:e.jsx($,{className:"text-xl"})})]})]})]})}),e.jsx("div",{onClick:s,className:"absolute inset-0 z-[51] bg-transparent","aria-label":"overlay"})]})},Pe=({hotspot:t,coordinateX:n,coordinateY:r,forceRenderPanorana:a,onClose:s})=>{const{idTour:c}=P(),{data:f}=L({id:Number(c)}),{mutate:x,status:h}=X(),{mutate:d,status:g}=Z(),[p,v]=m.useState((t==null?void 0:t.room_link_id)??null),l=()=>{const u=new FormData;u.append("room_link_id",String(p)),u.append("_method","PUT"),x({hostpot_id:Number(t.id),payload:u},{onSuccess:()=>{_({message:"Berhasil update hotspot"}),s(),v(null)},onError:()=>{N({message:"Gagal update hotspot"}),s(),v(null)}})},i=()=>{confirm("Yakin ingin menghapus hotspot ini ?")&&d({hostpot_id:t.id},{onSuccess:()=>{s(),_({message:"Berhasil menghapus hotspot"}),a()},onError:()=>{N({message:"Gagal menghapus hotspot"})}})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:u=>u.stopPropagation(),style:{position:"fixed",zIndex:"1000",left:n+30,top:r+10},className:"bg-white/90 rounded-md p-3 w-3/12",children:e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Select target room"}),e.jsx("div",{className:"my-3",children:f==null?void 0:f.data.map((u,S)=>e.jsx("button",{type:"button",className:w("bg-gray-300 transition w-full text-left px-2 py-2",u.id===p?"bg-gray-400 text-white":""),onClick:()=>{v(u.id)},children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{children:u.name}),(t==null?void 0:t.room_link_id)===u.id&&e.jsx(ce,{className:"text-2xl"})]})},S))})]}),e.jsxs("div",{className:"mt-2 flex justify-between items-center ",children:[e.jsx("div",{children:(h==="loading"||g==="loading")&&e.jsx(K,{size:16})}),e.jsxs("div",{className:"mt-2 flex justify-end items-center gap-x-4",children:[e.jsx("button",{onClick:l,disabled:h==="loading",type:"button",children:"Save"}),e.jsx("button",{onClick:i,className:"w-max",type:"button",disabled:g==="loading",children:e.jsx($,{className:"text-xl"})})]})]})]})}),e.jsx("div",{onClick:s,className:"absolute inset-0 z-[51] bg-transparent","aria-label":"overlay"})]})},Ie="",He=()=>{const[t]=A(),{data:n,status:r}=me({id:String(t.get("roomId"))}),{data:a}=pe({id:String(t.get("roomId"))}),s=m.useRef(null),c=q(Q),f=U(Y),[x,h]=m.useState(null),[d,g]=m.useState(null),[p,v]=m.useState({x:0,y:0}),l=m.useMemo(()=>n==null?void 0:n.data,[n==null?void 0:n.data,t.get("roomId")]),i=m.useMemo(()=>a==null?void 0:a.data.find(j=>j.id===Number(d)),[a==null?void 0:a.data,d]),u=({type:o,id:j})=>()=>{h(o),g(j)},S=m.useCallback(()=>{h(null),g(null)},[]),M=o=>{o.preventDefault(),v({x:o.clientX,y:o.clientY})},R=()=>{var b,k,z,D;const o=(k=(b=s==null?void 0:s.current)==null?void 0:b.getViewer())==null?void 0:k.getPitch(),j=(D=(z=s==null?void 0:s.current)==null?void 0:z.getViewer())==null?void 0:D.getYaw();f({pitch:o,yaw:j})};return e.jsxs("div",{className:"col-span-10 h-[calc(100vh_-_60px)] overflow-scroll relative",onClick:M,children:[e.jsx(F,{ref:s,title:l==null?void 0:l.name,width:"100%",height:"90vh",image:r==="success"?Ie+(l==null?void 0:l.image_url):"",autoLoad:!0,hfov:100,haov:360,vaov:180,pitch:c.pitch??(l==null?void 0:l.pitch),yaw:c.yaw??(l==null?void 0:l.yaw),hotspotDebug:!0,onRender:R,children:a==null?void 0:a.data.map((o,j)=>e.jsx(F.Hotspot,{type:"custom",pitch:o==null?void 0:o.pitch,yaw:o==null?void 0:o.yaw,autoRotate:0,cssClass:o.type=="info"?"info-custom-style":"",handleClick:u({id:String(o==null?void 0:o.id),type:o==null?void 0:o.type})},j))}),x==="info"&&d&&e.jsx(Me,{hotspot:i,coordinateX:p.x,coordinateY:p.y,forceRenderPanorana:()=>s.current.forceRender(),onClose:S}),x==="custom"&&d&&e.jsx(Pe,{hotspot:i,coordinateX:p.x,coordinateY:p.y,forceRenderPanorana:()=>s.current.forceRender(),onClose:S})]})};function Ue(){return e.jsx(re,{children:e.jsxs("div",{className:"grid grid-cols-12","aria-label":"editor-container",children:[e.jsx(we,{}),e.jsx(He,{})]})})}export{Ue as default};
