import{b as _,R as m,j as e,d as M,e as T,f as P,h as F,u as U,c as v,r as ae,i as se,k as ne,l as oe,m as re}from"./index-4b47ff25.js";import{d as ie,e as le,f as O,A as I,a as A,L as de}from"./tour-371de594.js";import{c as w,_ as S,e as j,s as y,G as N}from"./PulseLoader-2575482b.js";import{u as ce,M as V,A as q,B as ue,b as Y,c as me}from"./index.esm-51e9d067.js";import{a as pe}from"./index.esm-f9d75c26.js";import{u as xe,b as $,c as ge,d as he,a as fe}from"./room-e6c829d2.js";import{P as B}from"./PannellumVideo-83c9fc9d.js";const be="",je=({isShow:t,onClose:s})=>{var i;const{idTour:o}=_(),{data:a}=ce(),{mutate:n,status:c}=xe(),[l,d]=m.useState("Ruangan"),[p,r]=m.useState(null),x=u=>()=>r(u),g=()=>{s(),r(null)},f=()=>{if(!p){j({message:"Silahkan pilih gambar dahulu"});return}n({image_url:p,name:l,tour_id:Number(o)},{onSuccess:()=>{y({message:"Behasil membuat ruangan baru"}),d("Ruangan"),r(null),g()},onError:()=>{j({message:"Gagal membuat ruangan"})}})};return e.jsx(V,{show:t,children:e.jsxs("div",{className:"bg-white rounded-sm px-4 w-5/12",children:[e.jsx("header",{className:"flex justify-end pt-3","aria-label":"modal-head",children:e.jsx("button",{disabled:c==="loading",type:"button",onClick:g,children:e.jsx(q,{className:"text-lg"})})}),e.jsxs("div",{className:"py-4","aria-label":"modal-body",children:[e.jsx("div",{className:"max-h-[330px] overflow-auto","aria-label":"images-container",children:e.jsx("div",{className:"grid grid-cols-2 gap-3 pr-2","aria-label":"images-wrapper",children:(i=a==null?void 0:a.data)==null?void 0:i.map((u,b)=>e.jsxs("div",{className:w("col-span-1 cursor-pointer relative"),onClick:x(u.file_path),children:[e.jsx("img",{src:be+(u==null?void 0:u.thumbnail_path),alt:"avatar",loading:"lazy"}),p===u.file_path&&e.jsx("div",{className:"absolute inset-0 bg-black/60 z-10 flex justify-center items-center","aria-label":"selected-overlay",children:e.jsx("div",{className:"bg-white flex flex-col justify-center items-center rounded-full p-1",children:e.jsx(pe,{className:"text-4xl text-blue-600"})})})]},b))})}),e.jsxs("div",{className:"mt-3 px-3","aria-label":"submit-container",children:[e.jsxs("div",{className:"text-white",children:[e.jsx("label",{htmlFor:"tour-name",className:"text-sm",children:"Tour name"}),e.jsx("input",{id:"tour-name",type:"text",className:w("border-gray-300 focus:border-gray-300 focus:ring-0 px-4 text-gray-900","focus:outline-none w-full tracking-wide rounded-md","placeholder:font-medium placeholder:tracking-wide placeholder:text-gray-400","peer/search"),value:l,onChange:u=>d(u.target.value)})]}),e.jsx("button",{disabled:c==="loading",type:"button",onClick:f,className:"bg-blue-500 relative text-white w-full px-3 py-2 rounded-md font-medium mt-4",children:c==="loading"?e.jsx(S,{color:"white",size:10}):"Simpan"})]})]})]})})},ve=m.memo(()=>{const{idTour:t}=_(),{data:s}=ie({tour_id:Number(t)}),[o,a]=m.useState("");m.useEffect(()=>{a((s==null?void 0:s.data.name)??"")},[s==null?void 0:s.data.name]);const{mutate:n,status:c}=le(),l=()=>{n({tour_id:Number(t),name:o},{onSuccess:()=>{y({message:"Success update tour"})},onError:()=>{j({message:"Failed update tour"})}})};return e.jsxs("div",{className:"mt-3 px-3","aria-label":"submit",children:[e.jsxs("div",{className:"text-white",children:[e.jsx("label",{htmlFor:"tour-name",className:"text-sm",children:"Tour name"}),e.jsx("input",{id:"tour-name",type:"text",className:w("border-gray-300 focus:border-gray-300 focus:ring-0 px-4 text-gray-900","focus:outline-none w-full tracking-wide rounded-md","placeholder:font-medium placeholder:tracking-wide placeholder:text-gray-400","peer/search"),value:o,onChange:d=>a(d.target.value)})]}),e.jsx("button",{onClick:l,disabled:c==="loading",className:"bg-blue-500 relative text-white w-full px-3 py-2 rounded-md font-medium mt-4",children:c==="loading"?e.jsx(S,{color:"white",size:10}):"Simpan"})]})});M({key:"scene",default:[]});M({key:"scene-menu",default:null});const X=M({key:"viewer-coordinate",default:{pitch:0,yaw:0}}),Q=M({key:"initial-viewer-coordinate",default:{pitch:0,yaw:0}}),ye=()=>{const t=T();return O({mutationFn:async o=>{const a=new FormData;return a.append("tour_id",String(o.tour_id)),a.append("room_id",String(o.room_id)),a.append("pitch",String(o.pitch)),a.append("yaw",String(o.yaw)),a.append("type",String(o.type)),a.append("text",String(o.text??"")),(await I.post("/api/hotspot",a)).data},onSuccess:()=>t.invalidateQueries(["HOTSPOTS"])})},W=()=>{const t=T();return O({mutationFn:async o=>(await I.post(`/api/hotspot/${o.hostpot_id}`,o.payload,{headers:{"content-type":"application/x-www-form-urlencoded"}})).data,onSuccess:()=>t.invalidateQueries(["HOTSPOTS"])})},Z=()=>{const t=T();return O({mutationFn:async({hostpot_id:o})=>(await I.delete(`/api/hotspot/${o}`)).data,onSuccess:()=>t.invalidateQueries(["HOTSPOTS"])})};function we(t){return N({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M288 144a110.94 110.94 0 0 0-31.24 5 55.4 55.4 0 0 1 7.24 27 56 56 0 0 1-56 56 55.4 55.4 0 0 1-27-7.24A111.71 111.71 0 1 0 288 144zm284.52 97.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400c-98.65 0-189.09-55-237.93-144C98.91 167 189.34 112 288 112s189.09 55 237.93 144C477.1 345 386.66 400 288 400z"}}]})(t)}function Ne(t){return N({tag:"svg",attr:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"}}]})(t)}function Ce(t){return N({tag:"svg",attr:{fill:"none",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"}}]})(t)}function Se(t){return N({tag:"svg",attr:{fill:"none",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"}}]})(t)}function _e(t){return N({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 464c114.9 0 208-93.1 208-208S370.9 48 256 48 48 141.1 48 256s93.1 208 208 208zm0-244.5l-81.1 81.9c-7.5 7.5-19.8 7.5-27.3 0s-7.5-19.8 0-27.3l95.7-95.4c7.3-7.3 19.1-7.5 26.6-.6l94.3 94c3.8 3.8 5.7 8.7 5.7 13.7 0 4.9-1.9 9.9-5.6 13.6-7.5 7.5-19.7 7.6-27.3 0l-81-79.9z"}}]})(t)}function ke(t){return N({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M416 277.333H277.333V416h-42.666V277.333H96v-42.666h138.667V96h42.666v138.667H416v42.666z"}}]})(t)}const Re=m.memo(()=>{const[t]=P(),{idTour:s}=_(),o=t.get("roomId"),{mutate:a,status:n}=ye(),{mutate:c,status:l}=$(),d=F.useRecoilValue(X),[p,r]=m.useState(null),x=F.useSetRecoilState(Q),g=()=>{const i=new FormData;i.append("pitch",String(d.pitch)),i.append("yaw",String(d.yaw)),i.append("_method","PUT"),c({room_id:Number(o),payload:i},{onSuccess:()=>{y({message:"Berhasil update initial view"})},onError:()=>{j({message:"Gagal update initial view"})}})},f=i=>()=>{r(i),a({pitch:d.pitch,yaw:d.yaw,type:i,tour_id:Number(s),room_id:Number(o)},{onSuccess:()=>{y({message:"Berhasil menambah hotspot"}),r(null)},onError:()=>{j({message:"Gagal menambah hotspot"}),r(null)}}),x({pitch:d.pitch,yaw:d.yaw})};return e.jsxs("section",{className:"text-white py-1","aria-label":"tools",children:[e.jsx("h3",{className:"text-[.85rem] font-semibold px-5 text-gray-300",children:"TOOLS"}),e.jsxs("div",{className:"mt-2 flex flex-col gap-[3px]","aria-label":"btn-action-contianer",children:[e.jsx("button",{className:w("flex items-center gap-3 px-5 w-full py-[10px]","bg-gray-700 hover:bg-gray-600 transition"),type:"button",onClick:f("info"),disabled:n==="loading",children:n==="loading"&&p==="info"?e.jsx(S,{color:"white",size:10,className:"mx-auto py-[5px]"}):e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"text-2xl"}),e.jsx("p",{children:"Tambah Text"})]})}),e.jsx("button",{className:w("flex items-center gap-3 px-5 w-full py-[10px] bg-gray-700 hover:bg-gray-600 transition"),type:"button",onClick:f("custom"),disabled:n==="loading",children:n==="loading"&&p==="custom"?e.jsx(S,{color:"white",size:10,className:"mx-auto py-[5px]"}):e.jsxs(e.Fragment,{children:[e.jsx(_e,{className:"text-2xl"}),e.jsx("p",{children:"Tambah Hotspot"})]})}),e.jsx("button",{onClick:g,className:"flex items-center gap-3 px-5 w-full py-[10px] bg-gray-700",type:"button",disabled:l==="loading",children:l==="loading"?e.jsx(S,{color:"white",size:10,className:"mx-auto py-[5px]"}):e.jsxs(e.Fragment,{children:[e.jsx(we,{className:"text-2xl"}),e.jsx("p",{children:"Tetapkan view awal"})]})})]})]})});function Me(t){return N({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M231.4,44.34s0,.1,0,.15l-58.2,191.94a15.88,15.88,0,0,1-14,11.51q-.69.06-1.38.06a15.86,15.86,0,0,1-14.42-9.15l-35.71-75.39a4,4,0,0,1,.79-4.54l57.26-57.27a8,8,0,0,0-11.31-11.31L97.08,147.6a4,4,0,0,1-4.54.79l-75-35.53A16.37,16.37,0,0,1,8,97.36,15.89,15.89,0,0,1,19.57,82.84l191.94-58.2.15,0A16,16,0,0,1,231.4,44.34Z"}}]})(t)}const Te=m.memo(({onShowModal:t,onShowRoomPanel:s})=>{const[o]=P(),a=U(),{idTour:n}=_(),c=o.get("roomId"),{data:l}=A({id:Number(n)}),d=m.useMemo(()=>l==null?void 0:l.data,[l==null?void 0:l.data]),p=r=>()=>a(`/editor/${n}?roomId=${r}`);return e.jsxs("section",{className:"mt-2","aria-label":"ruangan",children:[e.jsxs("header",{className:"flex items-center justify-between pr-4",children:[e.jsx("h3",{className:"text-[.85rem] font-semibold px-5 text-gray-300",children:"RUANGAN"}),e.jsx("button",{className:"border border-white rounded-md p-[.4rem]",onClick:t,children:e.jsx(ke,{className:"text-white"})})]}),e.jsx("div",{className:"max-h-[300px] overflow-auto mt-2","aria-label":"list-ruangan-container",children:e.jsx("div",{className:"text-white flex flex-col gap-[3px]","aria-label":"list-ruangan-wrapper",children:d==null?void 0:d.map((r,x)=>e.jsxs("button",{className:w("flex items-center justify-between px-5 w-full py-3 relative",Number(c)===r.id?"bg-gray-600":"bg-gray-700"),type:"button",onClick:p(r.id),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Me,{className:"text-lg"}),e.jsx("p",{className:"",children:r.name})]}),e.jsx("div",{role:"button",tabIndex:0,onClick:s({room_id:r.id,room_name:r.name}),children:e.jsx(Ce,{className:"text-2xl"})})]},x))})})]})}),Pe=(t,s)=>(m.useEffect(()=>{const o=a=>{t.current&&!t.current.contains(a.target)&&s()};return document.addEventListener("click",o),()=>{document.removeEventListener("click",o)}},[s,t]),t);function Oe(t){return N({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",stroke:"#000",strokeWidth:"2",d:"M7,7 L17,17 M7,17 L17,7"}}]})(t)}const Ie=({isShow:t,room:s,onClose:o})=>{const{mutate:a,status:n}=$(),[c,l]=m.useState(s.name);m.useEffect(()=>{l(s.name)},[s.name]);const d=r=>{const x=r.target.value;x.length>=17||l(x)},p=()=>{if(c.length===0){j({message:"Nama tidak boleh kosong!"});return}const r=new FormData;r.append("name",c),r.append("_method","PUT"),a({room_id:s.id,payload:r},{onSuccess:()=>{y({message:"Behasil update nama ruangan"}),o()},onError:()=>{j({message:"Gagal update nama ruangan"})}})};return e.jsx(V,{show:t,children:e.jsxs("div",{className:"bg-white rounded-md px-4 w-4/12",children:[e.jsx("header",{className:"flex justify-end pt-3","aria-label":"modal-head",children:e.jsx("button",{disabled:n==="loading",type:"button",onClick:o,children:e.jsx(q,{className:"text-lg"})})}),e.jsx("div",{className:"mb-5","aria-label":"modal-body",children:e.jsxs("div",{className:"px-3","aria-label":"submit-container",children:[e.jsxs("div",{className:"text-black flex flex-col gap-1",children:[e.jsx("label",{htmlFor:"room-name",children:"Room name"}),e.jsx("input",{id:"room-name",type:"text",className:w("border-gray-300 focus:border-gray-300 focus:ring-0 px-4 text-gray-900","focus:outline-none w-full tracking-wide rounded-md","placeholder:font-medium placeholder:tracking-wide placeholder:text-gray-400","peer/search"),value:c,onChange:d})]}),e.jsx("button",{disabled:n==="loading",type:"button",onClick:p,className:"bg-blue-500 relative text-white w-full px-3 py-2 rounded-md font-medium mt-4",children:n==="loading"?e.jsx(S,{color:"white",size:10}):"Simpan Perubahan"})]})})]})})},ze=({tourId:t,roomId:s,roomName:o,coordinateX:a,coordinateY:n,onClose:c})=>{const l=m.useRef(null),d=U(),[p,r]=m.useState(!1),{mutate:x,status:g}=ge(),f=u=>()=>{if(u==="show"){r(!0);return}u==="close"&&r(!1)},i=()=>{confirm("Yakin ingin menghapus ruangan ini ?")&&x({room_id:s},{onSuccess:()=>{y({message:"Berhasil menghapus ruangan"}),d(`/editor/${t}`),c()},onError:()=>{j({message:"Gagal menghapus ruangan"})}})};return Pe(l,p?()=>{}:c),e.jsxs(e.Fragment,{children:[e.jsxs("div",{ref:l,onClick:u=>u.stopPropagation(),style:{position:"fixed",zIndex:"49",left:a+10,top:n+10},className:"bg-gray-100 rounded-md w-max shadow-md relative",children:[e.jsx("button",{type:"button",className:"absolute -top-4 -right-4 bg-gray-100 shadow-lg rounded-md",onClick:c,children:e.jsx(Oe,{className:"text-2xl"})}),e.jsxs("div",{className:"rounded-md overflow-hidden p-1 flex flex-col","aria-label":"panel-body",children:[e.jsx("button",{type:"button",className:"py-3 px-3 hover:bg-gray-200 transition rounded-md",onClick:f("show"),children:e.jsxs("div",{className:"flex justify-start items-center gap-3",children:[e.jsx(Se,{}),e.jsx("p",{children:"Ubah nama Ruangan"})]})}),e.jsx("button",{onClick:i,disabled:g==="loading",type:"button",className:"py-3 px-3 hover:bg-gray-200 transition rounded-md",children:g==="loading"?e.jsx(S,{color:"skyblue",size:10}):e.jsxs("div",{className:"flex justify-start items-center gap-3",children:[e.jsx(ue,{}),e.jsx("p",{children:"Hapus Ruangan"})]})})]})]}),e.jsx(Ie,{isShow:p,room:{id:s,name:o},onClose:f("close")})]})},G={addRoom:!1},Ee=()=>{const{idTour:t}=_(),[s,o]=m.useState(G),[a,n]=m.useState({id:null,name:""}),[c,l]=m.useState({x:0,y:0}),d=m.useCallback(g=>()=>{switch(g){case"addRoom":o({addRoom:!0});break}},[]),p=m.useCallback(({room_id:g,room_name:f})=>i=>{i.stopPropagation();const u={x:i.clientX,y:i.clientY};n({id:g,name:f}),l(u)},[]),r=()=>n({id:null,name:""}),x=m.useCallback(()=>o(G),[]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:w("col-span-2 bg-gray-800 pt-2 pb-5","min-h-[calc(100vh_-_60px)] flex flex-col justify-between"),children:[e.jsxs("div",{"aria-label":"top-side",children:[e.jsx(Re,{}),e.jsx(Te,{onShowModal:d("addRoom"),onShowRoomPanel:p})]}),e.jsx(ve,{})]}),a.id&&e.jsx(ze,{tourId:Number(t),roomId:a.id,roomName:a.name,coordinateX:c.x,coordinateY:c.y,onClose:r}),e.jsx(je,{isShow:s.addRoom,onClose:x})]})};var J={},R=v&&v.__assign||function(){return R=Object.assign||function(t){for(var s,o=1,a=arguments.length;o<a;o++){s=arguments[o];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t},R.apply(this,arguments)},He=v&&v.__createBinding||(Object.create?function(t,s,o,a){a===void 0&&(a=o);var n=Object.getOwnPropertyDescriptor(s,o);(!n||("get"in n?!s.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return s[o]}}),Object.defineProperty(t,a,n)}:function(t,s,o,a){a===void 0&&(a=o),t[a]=s[o]}),De=v&&v.__setModuleDefault||(Object.create?function(t,s){Object.defineProperty(t,"default",{enumerable:!0,value:s})}:function(t,s){t.default=s}),Fe=v&&v.__importStar||function(t){if(t&&t.__esModule)return t;var s={};if(t!=null)for(var o in t)o!=="default"&&Object.prototype.hasOwnProperty.call(t,o)&&He(s,t,o);return De(s,t),s},Be=v&&v.__rest||function(t,s){var o={};for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&s.indexOf(a)<0&&(o[a]=t[a]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,a=Object.getOwnPropertySymbols(t);n<a.length;n++)s.indexOf(a[n])<0&&Object.prototype.propertyIsEnumerable.call(t,a[n])&&(o[a[n]]=t[a[n]]);return o};Object.defineProperty(J,"__esModule",{value:!0});var Ge=Fe(ae),L=ne,Le=se,Ue=(0,Le.createAnimation)("ClipLoader","0% {transform: rotate(0deg) scale(1)} 50% {transform: rotate(180deg) scale(0.8)} 100% {transform: rotate(360deg) scale(1)}","clip");function Ae(t){var s=t.loading,o=s===void 0?!0:s,a=t.color,n=a===void 0?"#000000":a,c=t.speedMultiplier,l=c===void 0?1:c,d=t.cssOverride,p=d===void 0?{}:d,r=t.size,x=r===void 0?35:r,g=Be(t,["loading","color","speedMultiplier","cssOverride","size"]),f=R({background:"transparent !important",width:(0,L.cssValue)(x),height:(0,L.cssValue)(x),borderRadius:"100%",border:"2px solid",borderTopColor:n,borderBottomColor:"transparent",borderLeftColor:n,borderRightColor:n,display:"inline-block",animation:"".concat(Ue," ").concat(.75/l,"s 0s infinite linear"),animationFillMode:"both"},p);return o?Ge.createElement("span",R({style:f},g)):null}var K=J.default=Ae;const Ve=({hotspot:t,coordinateX:s,coordinateY:o,forceRenderPanorana:a,onClose:n})=>{const c=m.useRef(null),{mutate:l,status:d}=W(),{mutate:p,status:r}=Z(),[x,g]=m.useState((t==null?void 0:t.text)??"");m.useEffect(()=>{g(t.text)},[t.text]);const f=()=>{const u=new FormData;u.append("text",x),u.append("_method","PUT"),l({hostpot_id:Number(t.id),payload:u},{onSuccess:()=>{y({message:"Berhasil update hotspot"}),n()},onError:()=>{j({message:"Gagal update hotspot"}),n()}})},i=()=>{confirm("Yakin ingin menghapus hotspot ini ?")&&p({hostpot_id:t.id},{onSuccess:()=>{n(),y({message:"Berhasil menghapus hotspot"}),a()},onError:()=>{j({message:"Gagal menghapus hotspot"})}})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:c,onClick:u=>u.stopPropagation(),style:{position:"fixed",zIndex:"1000",left:s+30,top:o+10},className:"bg-white/90 rounded-md p-3",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{htmlFor:"information-text",className:"font-medium",children:"Information text"}),e.jsx("input",{id:"information-text",type:"text",className:"rounded-md",value:x,onChange:u=>g(u.target.value)})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[e.jsx("div",{children:(d==="loading"||r==="loading")&&e.jsx(K,{size:16})}),e.jsxs("div",{className:"flex justify-center items-center gap-x-3",children:[e.jsx("button",{disabled:d==="loading",type:"button",onClick:f,children:"Save"}),e.jsx("button",{disabled:r==="loading",onClick:i,type:"button",className:"w-max",children:e.jsx(Y,{className:"text-xl"})})]})]})]})}),e.jsx("div",{onClick:n,className:"absolute inset-0 z-[51] bg-transparent","aria-label":"overlay"})]})},qe=({hotspot:t,coordinateX:s,coordinateY:o,forceRenderPanorana:a,onClose:n})=>{const{idTour:c}=_(),{data:l}=A({id:Number(c)}),{mutate:d,status:p}=W(),{mutate:r,status:x}=Z(),[g,f]=m.useState((t==null?void 0:t.room_link_id)??null),i=()=>{const b=new FormData;b.append("room_link_id",String(g)),b.append("_method","PUT"),d({hostpot_id:Number(t.id),payload:b},{onSuccess:()=>{y({message:"Berhasil update hotspot"}),n(),f(null)},onError:()=>{j({message:"Gagal update hotspot"}),n(),f(null)}})},u=()=>{confirm("Yakin ingin menghapus hotspot ini ?")&&r({hostpot_id:t.id},{onSuccess:()=>{n(),y({message:"Berhasil menghapus hotspot"}),a()},onError:()=>{j({message:"Gagal menghapus hotspot"})}})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:b=>b.stopPropagation(),style:{position:"fixed",zIndex:"1000",left:s+30,top:o+10},className:"bg-white/90 rounded-md p-3 w-3/12",children:e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Select target room"}),e.jsx("div",{className:"my-3",children:l==null?void 0:l.data.map((b,k)=>e.jsx("button",{type:"button",className:w("bg-gray-300 transition w-full text-left px-2 py-2",b.id===g?"bg-gray-400 text-white":""),onClick:()=>{f(b.id)},children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{children:b.name}),(t==null?void 0:t.room_link_id)===b.id&&e.jsx(me,{className:"text-2xl"})]})},k))})]}),e.jsxs("div",{className:"mt-2 flex justify-between items-center ",children:[e.jsx("div",{children:(p==="loading"||x==="loading")&&e.jsx(K,{size:16})}),e.jsxs("div",{className:"mt-2 flex justify-end items-center gap-x-4",children:[e.jsx("button",{onClick:i,disabled:p==="loading",type:"button",children:"Save"}),e.jsx("button",{onClick:u,className:"w-max",type:"button",disabled:x==="loading",children:e.jsx(Y,{className:"text-xl"})})]})]})]})}),e.jsx("div",{onClick:n,className:"absolute inset-0 z-[51] bg-transparent","aria-label":"overlay"})]})},Ye="",$e=()=>{const[t]=P(),{data:s,status:o}=he({id:String(t.get("roomId"))}),{data:a}=fe({id:String(t.get("roomId"))}),n=m.useRef(null),c=oe(Q),l=re(X),[d,p]=m.useState(null),[r,x]=m.useState(null),[g,f]=m.useState({x:0,y:0}),i=m.useMemo(()=>s==null?void 0:s.data,[s==null?void 0:s.data,t.get("roomId")]),u=m.useMemo(()=>a==null?void 0:a.data.find(C=>C.id===Number(r)),[a==null?void 0:a.data,r]),b=({type:h,id:C})=>()=>{p(h),x(C)},k=m.useCallback(()=>{p(null),x(null)},[]),ee=h=>{h.preventDefault(),f({x:h.clientX,y:h.clientY})},te=()=>{var z,E,H,D;const h=(E=(z=n==null?void 0:n.current)==null?void 0:z.getViewer())==null?void 0:E.getPitch(),C=(D=(H=n==null?void 0:n.current)==null?void 0:H.getViewer())==null?void 0:D.getYaw();l({pitch:h,yaw:C})};return e.jsxs("div",{className:"col-span-10 h-[calc(100vh_-_60px)] overflow-scroll relative",onClick:ee,children:[e.jsx(B,{ref:n,title:i==null?void 0:i.name,width:"100%",height:"90vh",image:o==="success"?Ye+(i==null?void 0:i.image_url):"",autoLoad:!0,hfov:100,haov:360,vaov:180,pitch:c.pitch??(i==null?void 0:i.pitch),yaw:c.yaw??(i==null?void 0:i.yaw),hotspotDebug:!0,onRender:te,children:a==null?void 0:a.data.map((h,C)=>e.jsx(B.Hotspot,{type:"custom",pitch:h==null?void 0:h.pitch,yaw:h==null?void 0:h.yaw,autoRotate:0,cssClass:h.type=="info"?"info-custom-style":"",handleClick:b({id:String(h==null?void 0:h.id),type:h==null?void 0:h.type})},C))}),d==="info"&&r&&e.jsx(Ve,{hotspot:u,coordinateX:g.x,coordinateY:g.y,forceRenderPanorana:()=>n.current.forceRender(),onClose:k}),d==="custom"&&r&&e.jsx(qe,{hotspot:u,coordinateX:g.x,coordinateY:g.y,forceRenderPanorana:()=>n.current.forceRender(),onClose:k})]})};function tt(){return e.jsx(de,{children:e.jsxs("div",{className:"grid grid-cols-12","aria-label":"editor-container",children:[e.jsx(Ee,{}),e.jsx($e,{})]})})}export{tt as default};
